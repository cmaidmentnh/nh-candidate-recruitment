{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="mb-0"><i class="fas fa-gavel"></i> Speaker Vote Tracking</h1>
</div>

<div class="alert alert-secondary">
    <i class="fas fa-lock"></i>
    <strong>Private:</strong> Tracking commitments for Jason Osborne for Speaker among confirmed 2026 R candidates.
</div>

<!-- Summary Cards -->
<div class="row mb-4">
    <div class="col">
        <div class="card text-center bg-success text-white">
            <div class="card-body py-3">
                <h2 class="mb-0">{{ status_counts.get('committed', 0) }}</h2>
                <small>Committed</small>
            </div>
        </div>
    </div>
    <div class="col">
        <div class="card text-center bg-info text-white">
            <div class="card-body py-3">
                <h2 class="mb-0">{{ status_counts.get('leaning_yes', 0) }}</h2>
                <small>Leaning Yes</small>
            </div>
        </div>
    </div>
    <div class="col">
        <div class="card text-center bg-secondary text-white">
            <div class="card-body py-3">
                <h2 class="mb-0">{{ status_counts.get('unknown', 0) }}</h2>
                <small>Unknown</small>
            </div>
        </div>
    </div>
    <div class="col">
        <div class="card text-center bg-warning">
            <div class="card-body py-3">
                <h2 class="mb-0">{{ status_counts.get('leaning_no', 0) }}</h2>
                <small>Leaning No</small>
            </div>
        </div>
    </div>
    <div class="col">
        <div class="card text-center bg-danger text-white">
            <div class="card-body py-3">
                <h2 class="mb-0">{{ status_counts.get('opposed', 0) }}</h2>
                <small>Opposed</small>
            </div>
        </div>
    </div>
</div>

<!-- Vote Count Summary -->
<div class="card mb-4">
    <div class="card-body text-center">
        <h4>
            {% set total_yes = (status_counts.get('committed', 0) + status_counts.get('leaning_yes', 0)) %}
            {% set total_no = (status_counts.get('opposed', 0) + status_counts.get('leaning_no', 0)) %}
            {% set total_unknown = status_counts.get('unknown', 0) %}
            <span class="text-success">{{ total_yes }} Yes</span>
            /
            <span class="text-danger">{{ total_no }} No</span>
            /
            <span class="text-secondary">{{ total_unknown }} Unknown</span>
        </h4>
        <p class="text-muted mb-0">
            {{ legislators|length }} confirmed R candidates | Need majority for Speaker
        </p>
    </div>
</div>

<!-- Candidates Table -->
<div class="card">
    <div class="card-header">
        <i class="fas fa-users"></i> Confirmed Republican Candidates ({{ legislators|length }})
    </div>
    <div class="table-responsive">
        <table class="table table-hover mb-0">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>District</th>
                    <th>Status</th>
                    <th>Confidence</th>
                    <th>Last Contact</th>
                    <th>Notes</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for leg in legislators %}
                {# leg: candidate_id, first_name, last_name, email, phone1, district_code, incumbent, tracking_id, commitment_status, confidence_level, notes, last_contact_at #}
                <tr>
                    <td>
                        <strong>{{ leg[1] }} {{ leg[2] }}</strong>
                        {% if leg[6] %}<span class="badge badge-dark ml-1">Inc</span>{% endif %}
                    </td>
                    <td>{{ leg[5] or '—' }}</td>
                    <td>
                        {% set status = leg[8] or 'unknown' %}
                        <span class="badge badge-{% if status == 'committed' %}success{% elif status == 'leaning_yes' %}info{% elif status == 'opposed' %}danger{% elif status == 'leaning_no' %}warning{% else %}secondary{% endif %}">
                            {{ status|replace('_', ' ')|title }}
                        </span>
                    </td>
                    <td>
                        {% set conf = leg[9] or 5 %}
                        <div class="progress" style="width: 60px; height: 8px;">
                            <div class="progress-bar bg-{% if conf >= 7 %}success{% elif conf >= 4 %}warning{% else %}danger{% endif %}"
                                 style="width: {{ conf * 10 }}%"></div>
                        </div>
                        <small class="text-muted">{{ conf }}/10</small>
                    </td>
                    <td><small>{{ leg[11].strftime('%m/%d') if leg[11] else '—' }}</small></td>
                    <td><small class="text-muted">{{ leg[10]|truncate(40) if leg[10] else '' }}</small></td>
                    <td>
                        <a href="{{ url_for('private.speaker_vote_detail', candidate_id=leg[0]) }}" class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-eye"></i>
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
