{% extends "base.html" %}
{% block content %}
<h1 class="mb-3"><i class="fas fa-history"></i> Activity Log</h1>

<a href="{{ url_for('index') }}" class="btn btn-secondary mb-3"><i class="fas fa-arrow-left"></i> Back to Dashboard</a>

<div class="card">
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-striped mb-0">
                <thead class="thead-light">
                    <tr>
                        <th>Action</th>
                        <th>Description</th>
                        <th>By</th>
                        <th>When</th>
                    </tr>
                </thead>
                <tbody>
                    {% for activity in activities %}
                    <tr>
                        <td>
                            {% if activity[1] == 'candidate_added' %}
                                <span class="badge badge-success">Added</span>
                            {% elif activity[1] == 'candidate_updated' %}
                                <span class="badge badge-info">Updated</span>
                            {% elif activity[1] == 'candidate_copied' %}
                                <span class="badge badge-primary">Copied</span>
                            {% elif activity[1] == 'voter_matched' %}
                                <span class="badge badge-success">Matched</span>
                            {% elif activity[1] == 'voter_unmatched' %}
                                <span class="badge badge-warning">Unmatched</span>
                            {% elif activity[1] == 'status_changed' %}
                                <span class="badge badge-info">Status</span>
                            {% else %}
                                <span class="badge badge-secondary">{{ activity[1] }}</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if activity[3] %}
                                <a href="{{ url_for('edit_candidate', candidate_id=activity[3], election_year=2026) }}">{{ activity[2] }}</a>
                            {% else %}
                                {{ activity[2] }}
                            {% endif %}
                        </td>
                        <td><small>{{ activity[4].split('@')[0] if activity[4] else 'system' }}</small></td>
                        <td><small>{{ (activity[5] - timedelta(hours=5)).strftime('%m/%d/%Y %I:%M %p') }} ET</small></td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="4" class="text-center text-muted">No activity recorded yet</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Pagination -->
{% if total_pages > 1 %}
<nav class="mt-3">
    <ul class="pagination justify-content-center">
        {% if page > 1 %}
        <li class="page-item">
            <a class="page-link" href="{{ url_for('activity_log_page', page=page-1) }}">Previous</a>
        </li>
        {% endif %}
        
        {% for p in range(1, total_pages + 1) %}
            {% if p == page %}
            <li class="page-item active"><span class="page-link">{{ p }}</span></li>
            {% elif p == 1 or p == total_pages or (p >= page - 2 and p <= page + 2) %}
            <li class="page-item"><a class="page-link" href="{{ url_for('activity_log_page', page=p) }}">{{ p }}</a></li>
            {% elif p == page - 3 or p == page + 3 %}
            <li class="page-item disabled"><span class="page-link">...</span></li>
            {% endif %}
        {% endfor %}
        
        {% if page < total_pages %}
        <li class="page-item">
            <a class="page-link" href="{{ url_for('activity_log_page', page=page+1) }}">Next</a>
        </li>
        {% endif %}
    </ul>
</nav>
{% endif %}

<p class="text-muted mt-3">Showing page {{ page }} of {{ total_pages }}</p>
{% endblock %}